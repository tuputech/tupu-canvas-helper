{"version":3,"sources":["heatmap/config.js","heatmap/canvas2d.js","heatmap/renderer.js","heatmap/data.js","heatmap/core.js","index.js"],"names":["HeatmapConfig","defaultRadius","defaultRenderer","defaultGradient","defaultMaxOpacity","defaultMinOpacity","defaultBlur","defaultXField","defaultYField","defaultValueField","plugins","container","canvas","backgroundColor","width","height","useGradientOpacity","_getColorPalette","config","gradientConfig","gradient","paletteCanvas","document","createElement","paletteCtx","getContext","createLinearGradient","key","addColorStop","fillStyle","fillRect","getImageData","data","_getPointTemplate","radius","blurFactor","tplCanvas","tplCtx","x","y","beginPath","arc","Math","PI","fill","createRadialGradient","_prepareData","obj","min","max","radi","renderData","xValues","Object","keys","xValuesLen","length","xValue","yValues","yValuesLen","yValue","value","push","Canvas2dRenderer","shadowCanvas","_renderBoundaries","computed","getComputedStyle","className","_width","replace","_height","shadowCtx","ctx","style","cssText","position","appendChild","_palette","_templates","_setStyles","prototype","renderPartial","_drawAlpha","_colorize","renderAll","_clear","_updateGradient","updateConfig","setDimensions","clearRect","_blur","blur","_opacity","opacity","_maxOpacity","maxOpacity","_minOpacity","minOpacity","_useGradientOpacity","_min","_max","dataLen","point","rectX","rectY","tpl","templateAlpha","globalAlpha","drawImage","maxWidth","maxHeight","img","imgData","len","palette","i","alpha","offset","finalAlpha","putImageData","getValueAt","abs","getDataURL","toDataURL","getCanvas","Renderer","Store","_coordinator","_data","_total","_radi","_xField","_yField","_valueField","_cfgRadius","_organiseData","dataPoint","forceRender","store","storedVal","setDataMax","setDataMin","_unOrganizeData","unorganizedData","_onExtremaChange","emit","addData","arguments","dataArr","call","organisedEntry","getExtremaData","total","setData","dataPoints","pointsLen","_getInternalData","setCoordinator","coordinator","getData","Coordinator","cStore","on","evtName","callback","scope","_connect","renderer","_renderer","_store","_config","onExtremaChange","Heatmap","assign","pluginToLoad","Error","plugin","apply","removeData","configure","repaint","getGradient","heatmapFactory","create","register","pluginKey","drawImageScaled","layers","layer","options","canvasWidth","offsetWidth","canvasHeight","offsetHeight","actualSize","ratio","hRatio","vRatio","fixedWidth","fixedHeight","map","la","index","drawGradient","gradientCfg","extrema","type","padding","paddingL","paddingT","paddingR","paddingB","graW","graH","fontSize","bgW","bgH","x0","y0","x1","y1","font","textBottom","unit","fix","minValue","middleValue","maxValue","fillTexts","text","toFixed","item","fillText","getImageInfo","path","Promise","resolve","reject","Image","onload","onerror","e","src","drawHeatmap","points","directionPoints","accuracy","then","heatmapInstance","heatmap","gradientCanvas","directionCanvas","drawDirection","filtration","drawText","centerPoint","fontFamily","color","usePercent","border","w","h","getAbsPoint","measureText","drawTextBorder","textWidth","textAlign","textBaseLineCenterPoint","Array","isArray","rectWidth","rectHeight","rectL","rectT","leftTopPoint","drawRoundRect","lineWidth","lineColor","drawRect","drawPolygon","l","startPoint","moveTo","p","lineTo","strokeStyle","stroke","strokeRect","getPointsTotalAndMax","maxDirectionValue","isPointArray","canvasArrow","fromx","fromy","tox","toy","canvasGradient","headlen","angle","atan2","cos","sin","minImgLength","maxLinelength","round","direction","label","count","lineLength","pow2","pow","lengthXY","getExtremeValueForTrack","tracks","maxCount","minCount","canvasArrowForTrack","maxLineWidth","num","getTrackCanvas","diff","linePoint","walkPoints","drawTrack","trackCanvas"],"mappings":"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","file":"tupu-canvas-helper.js","sourceRoot":"..","sourcesContent":["'use strict'\n\nconst HeatmapConfig = {\n    // 默认半径: radius\n    defaultRadius: 40,\n    // 渲染主体: 目前只有dom端。只实现了canvas2d, 其他还可以自己渲染\n    // todo: 小程序, node端\n    defaultRenderer: 'canvas2d',\n    // 渐变的梯度, 定义热力红点\n    defaultGradient: {\n        0.25: 'rgb(0,0,255)',\n        0.55: 'rgb(0,255,0)',\n        0.85: 'rgb(255,255,0)',\n        1.0: 'rgb(255,0,0)',\n    },\n    // 透明度\n    defaultMaxOpacity: 1,\n    defaultMinOpacity: 0,\n\n    // 模糊设定\n    defaultBlur: 0.85,\n\n    // 坐标的x轴\n    defaultXField: 'x',\n    // 坐标的y轴\n    defaultYField: 'y',\n    // 坐标的权重key值\n    defaultValueField: 'value',\n    // 热力图的插件\n    plugins: {},\n\n    // 代码用到的\n\n    // canvas使用到的容器。\n    // 不传container直接传canvas也是可以的\n    container: null,\n    // canvas主体\n    canvas: null,\n    // canvas backgroundColor\n    backgroundColor: '',\n    // canvas的长宽, 不用带px。\n    // 不传默认取container的长宽\n    width: '',\n    height: '',\n    // 是否使用渐变透明度\n    useGradientOpacity: false,\n}\n\nexport default HeatmapConfig\n","const _getColorPalette = function(config) {\n    const gradientConfig = config.gradient || config.defaultGradient\n    const paletteCanvas = document.createElement('canvas')\n    const paletteCtx = paletteCanvas.getContext('2d')\n\n    paletteCanvas.width = 256\n    paletteCanvas.height = 1\n\n    // 创建canvas渐变对象\n    // params(x0,y0,x1,y1)\n    // 开始点坐标(x0,y0), 结束点坐标(x1, y1)\n    const gradient = paletteCtx.createLinearGradient(0, 0, 256, 1)\n    for (let key in gradientConfig) {\n        gradient.addColorStop(key, gradientConfig[key])\n    }\n\n    paletteCtx.fillStyle = gradient\n    // params(x,y,width,height)\n    // x: 矩形左上角的x坐标\n    // y: 矩形左上角的y坐标\n    paletteCtx.fillRect(0, 0, 256, 1)\n\n    // 返回ImageData 对象，该对象拷贝了画布指定矩形的像素数据。\n    const { data } = paletteCtx.getImageData(0, 0, 256, 1)\n    return data\n}\n\nconst _getPointTemplate = function(radius, blurFactor) {\n    const tplCanvas = document.createElement('canvas')\n    const tplCtx = tplCanvas.getContext('2d')\n    const x = radius\n    const y = radius\n    tplCanvas.width = tplCanvas.height = radius * 2\n\n    if (blurFactor === 1) {\n        tplCtx.beginPath()\n        tplCtx.arc(x, y, radius, 0, 2 * Math.PI, false)\n        tplCtx.fillStyle = 'rgba(0,0,0,1)'\n        tplCtx.fill()\n    } else {\n        // 里黑外白\n        const gradient = tplCtx.createRadialGradient(x, y, radius * blurFactor, x, y, radius)\n        gradient.addColorStop(0, 'rgba(0,0,0,1)')\n        gradient.addColorStop(1, 'rgba(0,0,0,0)')\n        tplCtx.fillStyle = gradient\n        tplCtx.fillRect(0, 0, 2 * radius, 2 * radius)\n    }\n\n    return tplCanvas\n}\n\nconst _prepareData = function(obj) {\n    const { min, max, radi, data } = obj\n    const renderData = []\n\n    const xValues = Object.keys(data)\n    let xValuesLen = xValues.length\n\n    while (xValuesLen--) {\n        const xValue = xValues[xValuesLen]\n        const yValues = Object.keys(data[xValue])\n        let yValuesLen = yValues.length\n        while (yValuesLen--) {\n            const yValue = yValues[yValuesLen]\n            const value = data[xValue][yValue]\n            const radius = radi[xValue][yValue]\n            renderData.push({\n                x: xValue,\n                y: yValue,\n                value: value,\n                radius: radius,\n            })\n        }\n    }\n\n    return {\n        min,\n        max,\n        data: renderData,\n    }\n}\n\nfunction Canvas2dRenderer(config) {\n    const container = config.container\n    // shadowCanvas外面不能配置?\n    const shadowCanvas = (this.shadowCanvas = document.createElement('canvas'))\n    const canvas = (this.canvas = config.canvas || document.createElement('canvas'))\n    // 原点的边界\n    this._renderBoundaries = [10000, 10000, 0, 0]\n\n    // 浏览器api, 获取容器的真实长宽。再set给shadowCanvas和canvas\n    // eslint-disable-next-line no-undef\n    const computed = config.container ? getComputedStyle(config.container) : {}\n\n    canvas.className = 'heatmap-canvas'\n\n    this._width = canvas.width = shadowCanvas.width =\n        config.width || +computed.width.replace(/px/, '')\n    this._height = canvas.height = shadowCanvas.height =\n        config.height || +computed.height.replace(/px/, '')\n\n    this.shadowCtx = shadowCanvas.getContext('2d')\n    this.ctx = canvas.getContext('2d')\n\n    // @TODO:\n    // conditional wrapper\n    canvas.style.cssText = shadowCanvas.style.cssText = 'position:absolute;left:0;top:0;'\n\n    if (container) {\n        container.style.position = 'relative'\n        container.appendChild(canvas)\n    }\n\n    // init 调色板;\n    // 返回 ImageData.data\n    this._palette = _getColorPalette(config)\n    this._templates = {}\n\n    // inin Styles\n    this._setStyles(config)\n}\n\nCanvas2dRenderer.prototype = {\n    renderPartial: function(data) {\n        if (data.data.length > 0) {\n            this._drawAlpha(data)\n            this._colorize()\n        }\n    },\n    renderAll: function(data) {\n        // reset render boundaries\n        this._clear()\n        if (Object.keys(data.data).length > 0) {\n            this._drawAlpha(_prepareData(data))\n            this._colorize()\n        }\n    },\n    _updateGradient: function(config) {\n        this._palette = _getColorPalette(config)\n    },\n    updateConfig: function(config) {\n        if (config['gradient']) {\n            this._updateGradient(config)\n        }\n        this._setStyles(config)\n    },\n    setDimensions: function(width, height) {\n        this._width = width\n        this._height = height\n        this.canvas.width = this.shadowCanvas.width = width\n        this.canvas.height = this.shadowCanvas.height = height\n    },\n    _clear: function() {\n        this.shadowCtx.clearRect(0, 0, this._width, this._height)\n        this.ctx.clearRect(0, 0, this._width, this._height)\n    },\n    _setStyles: function(config) {\n        this._blur = config.blur === 0 ? 0 : config.blur || config.defaultBlur\n\n        if (config.backgroundColor) {\n            this.canvas.style.backgroundColor = config.backgroundColor\n        }\n\n        this._width = this.canvas.width = this.shadowCanvas.width = config.width || this._width\n        this._height = this.canvas.height = this.shadowCanvas.height = config.height || this._height\n\n        this._opacity = (config.opacity || 0) * 255\n        this._maxOpacity = (config.maxOpacity || config.defaultMaxOpacity) * 255\n        this._minOpacity = (config.minOpacity || config.defaultMinOpacity) * 255\n        this._useGradientOpacity = !!config.useGradientOpacity\n    },\n    _drawAlpha: function(obj) {\n        const min = (this._min = obj.min)\n        const max = (this._max = obj.max)\n        const data = obj.data || []\n        let dataLen = data.length\n        // on a point basis?\n        const blur = 1 - this._blur\n\n        while (dataLen--) {\n            const point = data[dataLen]\n\n            const x = point.x\n            const y = point.y\n            const radius = point.radius\n            // if value is bigger than max\n            // use max as value\n            const value = Math.min(point.value, max)\n            const rectX = x - radius\n            const rectY = y - radius\n            const shadowCtx = this.shadowCtx\n\n            let tpl\n            if (!this._templates[radius]) {\n                this._templates[radius] = tpl = _getPointTemplate(radius, blur)\n            } else {\n                tpl = this._templates[radius]\n            }\n            // value from minimum / value range\n            // => [0, 1]\n            const templateAlpha = max - min === 0 ? 1 : (value - min) / (max - min)\n            // this fixes #176: small values are not visible because globalAlpha < .01 cannot be read from imageData\n            shadowCtx.globalAlpha = templateAlpha < 0.01 ? 0.01 : templateAlpha\n\n            // 左上角画一张图, 黑白色\n            shadowCtx.drawImage(tpl, rectX, rectY)\n\n            // update renderBoundaries\n            if (rectX < this._renderBoundaries[0]) {\n                this._renderBoundaries[0] = rectX\n            }\n            if (rectY < this._renderBoundaries[1]) {\n                this._renderBoundaries[1] = rectY\n            }\n            if (rectX + 2 * radius > this._renderBoundaries[2]) {\n                this._renderBoundaries[2] = rectX + 2 * radius\n            }\n            if (rectY + 2 * radius > this._renderBoundaries[3]) {\n                this._renderBoundaries[3] = rectY + 2 * radius\n            }\n        }\n    },\n    _colorize: function() {\n        let x = this._renderBoundaries[0]\n        let y = this._renderBoundaries[1]\n        let width = this._renderBoundaries[2] - x\n        let height = this._renderBoundaries[3] - y\n        const maxWidth = this._width\n        const maxHeight = this._height\n        const opacity = this._opacity\n        const maxOpacity = this._maxOpacity\n        const minOpacity = this._minOpacity\n        const useGradientOpacity = this._useGradientOpacity\n\n        if (x < 0) {\n            x = 0\n        }\n        if (y < 0) {\n            y = 0\n        }\n        if (x + width > maxWidth) {\n            width = maxWidth - x\n        }\n        if (y + height > maxHeight) {\n            height = maxHeight - y\n        }\n\n        let img = this.shadowCtx.getImageData(x, y, width, height)\n        const imgData = img.data\n        const len = imgData.length\n        const palette = this._palette\n\n        for (let i = 3; i < len; i += 4) {\n            // alpha代表透明度。数值越打代表越 range(0, 255)\n\n            // palette.length = 256 * 1 * 4\n            const alpha = imgData[i]\n            const offset = alpha * 4\n\n            if (!offset) {\n                continue\n            }\n\n            let finalAlpha\n            if (opacity > 0) {\n                // 本来已经有一个透明度了\n                finalAlpha = opacity * (alpha / 256)\n            } else {\n                if (alpha < maxOpacity) {\n                    if (alpha < minOpacity) {\n                        finalAlpha = minOpacity\n                    } else {\n                        finalAlpha = alpha\n                    }\n                } else {\n                    finalAlpha = maxOpacity\n                }\n            }\n\n            imgData[i - 3] = palette[offset]\n            imgData[i - 2] = palette[offset + 1]\n            imgData[i - 1] = palette[offset + 2]\n            // console.log('useGradientOpacity', useGradientOpacity)\n            // console.log('finalAlpha', finalAlpha)\n            imgData[i] = useGradientOpacity ? palette[offset + 3] : finalAlpha\n        }\n\n        // img.data = imgData\n        this.ctx.putImageData(img, x, y)\n\n        this._renderBoundaries = [1000, 1000, 0, 0]\n    },\n    getValueAt: function(point) {\n        let value\n        const shadowCtx = this.shadowCtx\n        const img = shadowCtx.getImageData(point.x, point.y, 1, 1)\n        const data = img.data[3]\n        const max = this._max\n        const min = this._min\n\n        value = (Math.abs(max - min) * (data / 255)) >> 0\n\n        return value\n    },\n    getDataURL: function() {\n        return this.canvas.toDataURL()\n    },\n    getCanvas: function() {\n        return this.canvas\n    },\n}\n\nexport default Canvas2dRenderer\n","'use strict'\n\nimport HeatmapConfig from './config'\nimport Canvas2dRenderer from './canvas2d'\n\nconst Renderer = HeatmapConfig['defaultRenderer'] === 'canvas2d' ? Canvas2dRenderer : false\n\nexport default Renderer\n","'use strict'\n\nimport HeatmapConfig from './config'\n\nconst Store = function Store(config) {\n    this._coordinator = {}\n    this._data = []\n    this._total = 0\n    this._radi = []\n    this._min = 10\n    this._max = 1\n    this._xField = config['xField'] || config.defaultXField\n    this._yField = config['yField'] || config.defaultYField\n    this._valueField = config['valueField'] || config.defaultValueField\n\n    if (config['radius']) {\n        this._cfgRadius = config['radius']\n    }\n}\n\nconst defaultRadius = HeatmapConfig.defaultRadius\n\nStore.prototype = {\n    // when forceRender = false -> called from setData, omits renderall event\n    _organiseData: function(dataPoint, forceRender) {\n        const x = dataPoint[this._xField]\n        const y = dataPoint[this._yField]\n        const radi = this._radi\n        const store = this._data\n        const max = this._max\n        const min = this._min\n        const value = dataPoint[this._valueField] || 1\n        const radius = dataPoint.radius || this._cfgRadius || defaultRadius\n\n        if (!store[x]) {\n            store[x] = []\n            radi[x] = []\n        }\n\n        if (!store[x][y]) {\n            store[x][y] = value\n            radi[x][y] = radius\n        } else {\n            store[x][y] += value\n        }\n        const storedVal = store[x][y]\n\n        this._total += storedVal\n\n        if (storedVal > max) {\n            if (!forceRender) {\n                this._max = storedVal\n            } else {\n                this.setDataMax(storedVal)\n            }\n            return false\n        } else if (storedVal < min) {\n            if (!forceRender) {\n                this._min = storedVal\n            } else {\n                this.setDataMin(storedVal)\n            }\n            return false\n        } else {\n            return {\n                x: x,\n                y: y,\n                value: value,\n                radius: radius,\n                min: min,\n                max: max,\n            }\n        }\n    },\n    _unOrganizeData: function() {\n        const unorganizedData = []\n        const data = this._data\n        const radi = this._radi\n\n        for (const x in data) {\n            for (const y in data[x]) {\n                unorganizedData.push({\n                    x: x,\n                    y: y,\n                    radius: radi[x][y],\n                    value: data[x][y],\n                })\n            }\n        }\n        return {\n            min: this._min,\n            max: this._max,\n            data: unorganizedData,\n        }\n    },\n    _onExtremaChange: function() {\n        this._coordinator.emit('extremachange', {\n            min: this._min,\n            max: this._max,\n        })\n    },\n    addData: function() {\n        if (arguments[0].length > 0) {\n            const dataArr = arguments[0]\n            let dataLen = dataArr.length\n            while (dataLen--) {\n                // eslint-disable-next-line no-useless-call\n                this.addData.call(this, dataArr[dataLen])\n            }\n        } else {\n            // add to store\n            const organisedEntry = this._organiseData(arguments[0], true)\n            if (organisedEntry) {\n                // if it's the first datapoint initialize the extremas with it\n                if (this._data.length === 0) {\n                    this._min = this._max = organisedEntry.value\n                }\n                this._coordinator.emit('renderpartial', {\n                    min: this._min,\n                    max: this._max,\n                    data: [organisedEntry],\n                })\n            }\n        }\n        return this\n    },\n    getExtremaData: function() {\n        return {\n            max: this._max,\n            min: this._min,\n            total: this._total,\n        }\n    },\n    setData: function(obj) {\n        const { data, max, min } = obj\n        const dataPoints = data\n        const pointsLen = dataPoints.length\n\n        // reset data arrays\n        this._data = []\n        this._radi = []\n\n        for (let i = 0; i < pointsLen; i++) {\n            this._organiseData(dataPoints[i], false)\n        }\n\n        if (max || min) {\n            this._max = max\n            this._min = min || 0\n        }\n\n        this._onExtremaChange()\n        this._coordinator.emit('renderall', this._getInternalData())\n        return this\n    },\n    setCoordinator: function(coordinator) {\n        this._coordinator = coordinator\n    },\n    _getInternalData: function() {\n        return {\n            max: this._max,\n            min: this._min,\n            data: this._data,\n            radi: this._radi,\n        }\n    },\n    getData: function() {\n        return this._unOrganizeData()\n    },\n}\n\nexport default Store\n","'use strict'\n\nimport HeatmapConfig from './config'\nimport Renderer from './renderer'\nimport Store from './data'\n\n/**\n * 自定义监听器\n * on: 监听\n * emit: 触发事件\n */\nfunction Coordinator() {\n    this.cStore = {}\n}\n\nCoordinator.prototype = {\n    on: function(evtName, callback, scope) {\n        const cStore = this.cStore\n\n        if (!cStore[evtName]) {\n            cStore[evtName] = []\n        }\n        cStore[evtName].push(function(data) {\n            return callback.call(scope, data)\n        })\n    },\n    emit: function(evtName, data) {\n        const cStore = this.cStore\n        if (cStore[evtName]) {\n            const len = cStore[evtName].length\n            for (let i = 0; i < len; i++) {\n                const callback = cStore[evtName][i]\n                callback(data)\n            }\n        }\n    },\n}\n\nconst _connect = function(scope) {\n    const renderer = scope._renderer\n    const coordinator = scope._coordinator\n    const store = scope._store\n\n    // 监听渲染部分\n    coordinator.on('renderpartial', renderer.renderPartial, renderer)\n    // 监听渲染全部\n    coordinator.on('renderall', renderer.renderAll, renderer)\n\n    // 监听min, max是否发生变化。\n    // 可以在set config设置回调。\n    coordinator.on('extremachange', function(data) {\n        scope._config.onExtremaChange &&\n            scope._config.onExtremaChange({\n                min: data.min,\n                max: data.max,\n                gradient: scope._config['gradient'] || scope._config['defaultGradient'],\n            })\n    })\n\n    store.setCoordinator(coordinator)\n}\n\nfunction Heatmap(config = {}) {\n    config = this._config = Object.assign(HeatmapConfig, config)\n    this._coordinator = new Coordinator()\n\n    /**\n     * 用户自定义的插件, 使用前需要注册插件\n     * 插件需要自带renderer和store属性\n     */\n    if (config['plugin']) {\n        const pluginToLoad = config['plugin']\n        if (!HeatmapConfig.plugins[pluginToLoad]) {\n            throw new Error(\"Plugin '\" + pluginToLoad + \"' not found. Maybe it was not registered.\")\n        } else {\n            const plugin = HeatmapConfig.plugins[pluginToLoad]\n            // set plugin renderer and store\n            // eslint-disable-next-line new-cap\n            this._renderer = new plugin.renderer(config)\n            // eslint-disable-next-line new-cap\n            this._store = new plugin.store(config)\n        }\n    } else {\n        // init canvas2d\n        // container appendChild canvas\n        // 初始化调色板\n        // get到canvas的属性/样式\n        this._renderer = new Renderer(config)\n\n        // init store\n        this._store = new Store(config)\n    }\n    _connect(this)\n}\n\n// @TODO:\n// add API documentation\nHeatmap.prototype = {\n    addData: function() {\n        this._store.addData.apply(this._store, arguments)\n        return this\n    },\n    removeData: function() {\n        this._store.removeData && this._store.removeData.apply(this._store, arguments)\n        return this\n    },\n    setData: function() {\n        this._store.setData.apply(this._store, arguments)\n        return this\n    },\n    setDataMax: function() {\n        this._store.setDataMax.apply(this._store, arguments)\n        return this\n    },\n    setDataMin: function() {\n        this._store.setDataMin.apply(this._store, arguments)\n        return this\n    },\n    configure: function(config) {\n        this._config = Object.assign(this._config, config)\n        this._renderer.updateConfig(this._config)\n        this._coordinator.emit('renderall', this._store._getInternalData())\n        return this\n    },\n    repaint: function() {\n        this._coordinator.emit('renderall', this._store._getInternalData())\n        return this\n    },\n    getData: function() {\n        return this._store.getData()\n    },\n    getDataURL: function() {\n        return this._renderer.getDataURL()\n    },\n    getCanvas: function() {\n        return this._renderer.getCanvas()\n    },\n    getGradient: function() {\n        return this._config['gradient'] || this._config['defaultGradient']\n    },\n    getExtremaData: function() {\n        return this._store.getExtremaData()\n    },\n    getValueAt: function(point) {\n        if (this._store.getValueAt) {\n            return this._store.getValueAt(point)\n        } else if (this._renderer.getValueAt) {\n            return this._renderer.getValueAt(point)\n        } else {\n            return null\n        }\n    },\n}\n\n// core\nconst heatmapFactory = {\n    create: function(config) {\n        return new Heatmap(config)\n    },\n    register: function(pluginKey, plugin) {\n        HeatmapConfig.plugins[pluginKey] = plugin\n    },\n}\n\nexport default heatmapFactory\n","import heatmap from './heatmap/core'\n\nexport function drawImageScaled({ img, layers = [], layer, canvas, options = {} }) {\n    const ctx = canvas.getContext('2d')\n\n    if (layers.length === 0 && layer) {\n        layers = [layer]\n    }\n\n    const canvasWidth = Math.max(canvas.offsetWidth, canvas.width)\n    const canvasHeight = Math.max(canvas.offsetHeight, canvas.height)\n    let actualSize = {\n        width: canvasWidth,\n        height: canvasHeight,\n    }\n    if (img) {\n        let ratio\n        const hRatio = canvasWidth / img.width\n        const vRatio = canvasHeight / img.height\n        if (options.fixedWidth) {\n            ratio = hRatio\n        } else if (options.fixedHeight) {\n            ratio = vRatio\n        } else {\n            ratio = Math.min(hRatio, vRatio)\n        }\n        actualSize = {\n            width: img.width * ratio,\n            height: img.height * ratio,\n        }\n    }\n\n    canvas.width = actualSize.width\n    canvas.height = actualSize.height\n\n    layers.map((la, index) => {\n        if (!la) {\n            return\n        }\n\n        ctx.drawImage(la, 0, 0, la.width, la.height, 0, 0, actualSize.width, actualSize.height)\n    })\n}\n\n/* 画渐变标尺 */\nfunction drawGradient({ gradientCfg, extrema, width, height, type = 'maxPercent' }) {\n    let canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    const ctx = canvas.getContext('2d')\n\n    const padding = width * 0.02\n    const [paddingL, paddingT, paddingR, paddingB] = [padding, padding, padding, padding / 4]\n    const graW = width * 0.13\n    const graH = height * 0.008\n    const fontSize = width * 0.016\n    const bgW = graW + paddingL + paddingR\n    const bgH = graH + paddingT + paddingB\n    ctx.fillStyle = 'rgba(0,0,0, 0.5)'\n\n    // 黑色半透明底色\n    ctx.fillRect(width - bgW, height - bgH, bgW, bgH)\n\n    // 渐变\n    const x0 = width - paddingR - graW\n    const y0 = height - paddingB - graH\n    const x1 = width - paddingR\n    const y1 = height - paddingB\n\n    const gradient = ctx.createLinearGradient(x0, y0, x1, y1)\n    for (let key in gradientCfg) {\n        gradient.addColorStop(key, gradientCfg[key])\n    }\n    ctx.fillStyle = gradient\n    ctx.fillRect(x0, y0, graW, graH)\n\n    // 极值\n    ctx.font = `normal ${fontSize}px Microsoft YaHei`\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)'\n    const textBottom = height - graH - paddingB * 1.5\n    const { min = 0, max = 0, total } = extrema\n\n    let unit = ''\n    let fix = 0\n    let minValue = min\n    let middleValue = (min + max) / 2\n    let maxValue = max\n\n    if (total !== 0 && type === 'maxPercent') {\n        unit = '%'\n        fix = 1\n        minValue = (min / total) * 100\n        middleValue = ((min + max) / 2 / total) * 100\n        maxValue = (max / total) * 100\n    }\n\n    const fillTexts = [\n        {\n            text: minValue.toFixed(fix) + unit,\n            x: width - bgW + paddingB,\n            y: textBottom,\n        },\n        {\n            text: middleValue.toFixed(fix) + unit,\n            x: width - bgW + graW / 2,\n            y: textBottom,\n        },\n        {\n            text: maxValue.toFixed(fix) + unit,\n            x: width - paddingR * 2,\n            y: textBottom,\n        },\n    ]\n\n    // eslint-disable-next-line array-callback-return\n    fillTexts.map((item) => {\n        const { text, x, y } = item\n        ctx.fillText(text, x, y)\n    })\n\n    return canvas\n}\n\nexport function getImageInfo(path) {\n    return new Promise((resolve, reject) => {\n        const img = new Image()\n        img.onload = () => {\n            resolve(img)\n        }\n        img.onerror = (e) => {\n            reject(e)\n        }\n        img.src = path\n    })\n}\n\nexport function drawHeatmap({\n    points,\n    directionPoints,\n    path,\n    canvas,\n    type = 'maxPercent',\n    accuracy = 33,\n    radius,\n    options = {},\n}) {\n    return getImageInfo(path)\n        .then((img) => {\n            const { width, height } = img\n            radius = radius || Math.max(width, height) / accuracy\n            points = points.map(({ x, y, value }) => {\n                x = x * width\n                y = y * height\n                return { x, y, value }\n            })\n\n            let obj = {}\n            obj.data = points\n\n            const heatmapInstance = heatmap.create({\n                opacity: 0.6,\n                width,\n                height,\n                radius,\n            })\n\n            heatmapInstance.setData(obj)\n            return { img, heatmapInstance }\n        })\n        .then(({ img, heatmapInstance }) => {\n            const { width, height } = img\n            const gradientCfg = heatmapInstance.getGradient()\n            const extrema = heatmapInstance.getExtremaData()\n            const gradientCanvas = drawGradient({\n                gradientCfg,\n                extrema,\n                width,\n                height,\n                type,\n            })\n\n            let directionCanvas = null\n\n            if (directionPoints && directionPoints.length > 0) {\n                directionCanvas = drawDirection({\n                    points: directionPoints,\n                    width,\n                    height,\n                    accuracy: 6,\n                    filtration: 0.03,\n                })\n            }\n\n            const layers = [img, heatmapInstance.getCanvas(), directionCanvas, gradientCanvas]\n            drawImageScaled({ img, layers, canvas, options })\n            return { img, heatmap: heatmapInstance }\n        })\n}\n// 坐标为文本基准线中点\nexport function drawText(\n    canvas,\n    text = '',\n    centerPoint = [0, 0],\n    {\n        fontSize = 20,\n        fontFamily = 'PingFangSC-Regular',\n        color = '#000',\n        usePercent = true,\n        border,\n    } = {}\n) {\n    const { width: w, height: h } = canvas\n    const [x, y] = usePercent ? getAbsPoint(centerPoint, w, h) : centerPoint\n    const ctx = canvas.getContext('2d')\n    if (border) {\n        const { width } = ctx.measureText(text)\n        drawTextBorder(\n            canvas,\n            [x, y],\n            Object.assign({}, border, { textWidth: width, fontSize, usePercent: false })\n        )\n    }\n    ctx.font = `${fontSize}px ${fontFamily}`\n    ctx.textAlign = 'center'\n    ctx.fillStyle = color\n    ctx.fillText(text, x, y)\n}\n\nexport function drawTextBorder(\n    canvas,\n    textBaseLineCenterPoint = [0, 0],\n    { padding = 0, radius, textWidth, width, color, fontSize, backgroundColor, usePercent }\n) {\n    const [x, y] = textBaseLineCenterPoint\n    let paddingL, paddingT\n    if (typeof padding === 'number') {\n        paddingL = paddingT = padding\n    } else if (Array.isArray(padding)) {\n        paddingT = padding[0]\n        paddingL = padding[1]\n    }\n    const rectWidth = paddingL * 2 + textWidth\n    const rectHeight = paddingT * 2 + fontSize\n    const rectL = x - rectWidth / 2\n    const rectT = y - fontSize - paddingT\n    const leftTopPoint = [rectL, rectT]\n    if (radius) {\n        drawRoundRect(canvas, leftTopPoint, {\n            radius,\n            width: rectWidth,\n            height: rectHeight,\n            lineWidth: width || 1,\n            lineColor: color,\n            backgroundColor: backgroundColor,\n            usePercent: false,\n        })\n    } else {\n        drawRect(canvas, leftTopPoint, {\n            width: rectWidth,\n            height: rectHeight,\n            lineWidth: width || 1,\n            lineColor: color,\n            backgroundColor: backgroundColor,\n            usePercent: false,\n        })\n    }\n}\n\nexport function drawPolygon(\n    canvas,\n    points,\n    { color = 'red', usePercent = true, lineWidth, backgroundColor }\n) {\n    const { width: w, height: h } = canvas\n    const l = points.length\n    const ctx = canvas.getContext('2d')\n    ctx.beginPath()\n    const startPoint = usePercent ? getAbsPoint(points[0], w, h) : points[0]\n    ctx.moveTo(...startPoint)\n    for (let i = 1; i < l; i++) {\n        const p = usePercent ? getAbsPoint(points[i], w, h) : points[i]\n        ctx.lineTo(...p)\n    }\n    ctx.lineTo(...startPoint)\n    if (lineWidth) {\n        ctx.lineWidth = lineWidth\n        ctx.strokeStyle = color\n        ctx.stroke()\n    }\n    if (backgroundColor) {\n        ctx.fillStyle = backgroundColor\n        ctx.fill()\n    }\n}\n\nexport function drawRoundRect(\n    canvas,\n    leftTopPoint,\n    {\n        width,\n        height,\n        radius = 4,\n        lineWidth,\n        lineColor = 'red',\n        backgroundColor,\n        usePercent = true,\n    } = {}\n) {\n    const { width: w, height: h } = canvas\n    const ctx = canvas.getContext('2d')\n    const [x, y] = usePercent ? getAbsPoint(leftTopPoint, w, h) : leftTopPoint\n    ctx.beginPath()\n    ctx.moveTo(x, y)\n    ctx.lineTo(x + width, y)\n    ctx.arc(x + width, y + radius, radius, -0.5 * Math.PI, 0)\n    ctx.lineTo(x + width + radius, y + radius + height)\n    ctx.arc(x + width, y + height + radius, radius, 0, 0.5 * Math.PI)\n    ctx.lineTo(x, y + height + 2 * radius)\n    ctx.arc(x, y + radius + height, radius, 0.5 * Math.PI, 1 * Math.PI)\n    ctx.lineTo(x - radius, y + radius)\n    ctx.arc(x, y + radius, radius, 1 * Math.PI, 1.5 * Math.PI)\n    if (backgroundColor) {\n        ctx.fillStyle = backgroundColor\n        ctx.fill()\n    }\n    if (lineWidth) {\n        ctx.lineWidth = lineWidth\n        ctx.strokeStyle = lineColor\n        ctx.stroke()\n    }\n}\n\nexport function drawRect(\n    canvas,\n    leftTopPoint,\n    { width, height, lineWidth, lineColor = 'red', backgroundColor, usePercent = true }\n) {\n    const { width: canvasWidth, height: canvasHeight } = canvas\n    const ctx = canvas.getContext('2d')\n    const [x, y] = usePercent ? getAbsPoint(leftTopPoint, canvasWidth, canvasHeight) : leftTopPoint\n    const w = usePercent ? width * canvasWidth : width\n    const h = usePercent ? height * canvasHeight : height\n\n    if (backgroundColor) {\n        ctx.fillStyle = backgroundColor\n        ctx.fillRect(x, y, w, h)\n    }\n    if (lineWidth) {\n        ctx.strokeStyle = lineColor\n        ctx.lineWidth = lineWidth\n        ctx.strokeRect(x, y, w, h)\n    }\n}\n\nfunction getAbsPoint(point, w, h) {\n    return [w * point[0], h * point[1]]\n}\n\nfunction getPointsTotalAndMax(points) {\n    let total = 0\n    let maxDirectionValue = 0\n    let maxValue = 0\n    points.map(function(point) {\n        // console.log(point[0]*w, point[1]*h)\n        let isPointArray = Array.isArray(point),\n            value = isPointArray ? 1 : point.value\n        total += value\n\n        maxDirectionValue = point.max > maxDirectionValue ? point.max : maxDirectionValue\n        maxValue = point.value > maxValue ? point.value : maxValue\n    })\n    return { total, maxDirectionValue, maxValue }\n}\n\nfunction canvasArrow(ctx, fromx, fromy, tox, toy, lineWidth) {\n    const canvasGradient = ctx.createLinearGradient(fromx, fromy, tox, toy)\n    canvasGradient.addColorStop(0, 'rgba(255, 239, 120, 0)')\n    canvasGradient.addColorStop(0.5, 'rgba(255, 239, 120, 1)')\n    //canvasGradient.addColorStop(1, \"rgba(255, 239, 120, 1)\")\n    ctx.strokeStyle = canvasGradient\n\n    const headlen = lineWidth, // length of head in pixels\n        angle = Math.atan2(toy - fromy, tox - fromx)\n\n    ctx.moveTo(fromx, fromy)\n    ctx.lineTo(tox, toy)\n    ctx.moveTo(tox, toy)\n    ctx.lineTo(\n        tox - headlen * Math.cos(angle - Math.PI / 7),\n        toy - headlen * Math.sin(angle - Math.PI / 7)\n    )\n\n    //path from the side point of the arrow, to the other side point\n    ctx.lineTo(\n        tox - headlen * Math.cos(angle + Math.PI / 7),\n        toy - headlen * Math.sin(angle + Math.PI / 7)\n    )\n\n    //path from the side point back to the tip of the arrow, and then again to the opposite side point\n    ctx.lineTo(tox, toy)\n    ctx.lineTo(\n        tox - headlen * Math.cos(angle - Math.PI / 7),\n        toy - headlen * Math.sin(angle - Math.PI / 7)\n    )\n}\n\nexport function drawDirection({ points, width, height, accuracy = 6, filtration = 0.03 }) {\n    let canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    const ctx = canvas.getContext('2d')\n\n    const { maxValue } = getPointsTotalAndMax(points)\n\n    const minImgLength = Math.min(width, height)\n\n    const maxLinelength = Math.round(minImgLength / accuracy) / 2\n    const lineWidth = maxLinelength * 0.06\n    ctx.lineWidth = lineWidth\n\n    points.map((point) => {\n        // value: 一个区域的总人数\n        const { direction, x, y, value, max } = point\n        ctx.beginPath()\n\n        // 大于最大值的某个范围才画轨迹线\n        if (value / maxValue > filtration) {\n            direction.map((item) => {\n                ctx.beginPath()\n\n                let fromx = Math.round(width * x)\n                let fromy = Math.round(height * y)\n\n                const { label, count } = item\n\n                // 预留顶点坐标周围的空白\n                const offset = 0\n\n                let tox = 0\n                let toy = 0\n\n                const lineLength = maxLinelength * (count / max)\n\n                // 后方\n                if (label === 0) {\n                    tox = fromx\n                    toy = fromy + offset + lineLength\n                    fromy = fromy + offset\n                }\n                // 前方\n                if (label === 1) {\n                    tox = fromx\n                    toy = fromy - offset - lineLength\n                    fromy = fromy - offset\n                }\n                // 左方\n                if (label === 2) {\n                    tox = fromx - offset - lineLength\n                    toy = fromy\n                    fromx = fromx - offset\n                }\n                // 右方\n                if (label === 3) {\n                    tox = fromx + offset + lineLength\n                    toy = fromy\n                    fromx = fromx + offset\n                }\n\n                // 左后方\n                if (label === 4) {\n                    const pow2 = Math.pow(lineLength, 2)\n                    const lengthXY = Math.pow(pow2 / 2, 0.5)\n                    tox = fromx - offset - lengthXY\n                    toy = fromy + offset + lengthXY\n                    fromx = fromx - offset\n                    fromy = fromy + offset\n                }\n                // 左前方\n                if (label === 5) {\n                    const pow2 = Math.pow(lineLength, 2)\n                    const lengthXY = Math.pow(pow2 / 2, 0.5)\n                    tox = fromx - offset - lengthXY\n                    toy = fromy - offset - lengthXY\n                    fromx = fromx - offset\n                    fromy = fromy - offset\n                }\n                // 右后方\n                if (label === 6) {\n                    const pow2 = Math.pow(lineLength, 2)\n                    const lengthXY = Math.pow(pow2 / 2, 0.5)\n                    tox = fromx + offset + lengthXY\n                    toy = fromy + offset + lengthXY\n                    fromx = fromx + offset\n                    fromy = fromy + offset\n                }\n                // 右前方\n                if (label === 7) {\n                    const pow2 = Math.pow(lineLength, 2)\n                    const lengthXY = Math.pow(pow2 / 2, 0.5)\n                    tox = fromx + offset + lengthXY\n                    toy = fromy - offset - lengthXY\n                    fromx = fromx + offset\n                    fromy = fromy - offset\n                }\n\n                if (tox !== 0 && toy !== 0) {\n                    canvasArrow(ctx, fromx, fromy, tox, toy, lineWidth)\n                }\n                ctx.stroke()\n            })\n        }\n    })\n    return canvas\n}\n\nfunction getExtremeValueForTrack(tracks) {\n    let maxCount = 0\n    let minCount = 0\n    tracks.map((item, i) => {\n        const { count } = item\n\n        maxCount = Math.max(count, maxCount)\n        if (i === 0) {\n            minCount = count\n        } else {\n            minCount = Math.min(count, minCount)\n        }\n    })\n    return { minCount, maxCount }\n}\n\nfunction canvasArrowForTrack(ctx, fromx, fromy, tox, toy, maxLineWidth) {\n    const headlen = maxLineWidth * 0.2\n    const angle = Math.atan2(toy - fromy, tox - fromx)\n    const num = 10\n\n    ctx.moveTo(fromx, fromy)\n    ctx.lineTo(tox, toy)\n    ctx.moveTo(tox, toy)\n    ctx.lineTo(\n        tox - headlen * Math.cos(angle - Math.PI / num),\n        toy - headlen * Math.sin(angle - Math.PI / num)\n    )\n\n    //path from the side point of the arrow, to the other side point\n    ctx.lineTo(\n        tox - headlen * Math.cos(angle + Math.PI / num),\n        toy - headlen * Math.sin(angle + Math.PI / num)\n    )\n\n    //path from the side point back to the tip of the arrow, and then again to the opposite side point\n    ctx.lineTo(tox, toy)\n    ctx.lineTo(\n        tox - headlen * Math.cos(angle - Math.PI / num),\n        toy - headlen * Math.sin(angle - Math.PI / num)\n    )\n    ctx.fill()\n}\n\nfunction getTrackCanvas({ width, height, tracks }) {\n    let canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    const ctx = canvas.getContext('2d')\n\n    const { minCount, maxCount } = getExtremeValueForTrack(tracks)\n    const diff = maxCount - minCount\n\n    const color = 'rgba(255, 239, 120, 0.5)'\n    ctx.strokeStyle = color\n    ctx.fillStyle = color\n\n    const minImgLength = Math.min(width, height)\n    const maxLineWidth = minImgLength * 0.015\n\n    tracks.map((linePoint) => {\n        ctx.beginPath()\n\n        const count = linePoint.count\n        const lineWidth = ((count - minCount) / diff) * maxLineWidth + 1\n\n        ctx.lineWidth = lineWidth\n        const points = linePoint.points || linePoint.walkPoints || []\n\n        points.map((point, index) => {\n            if (index >= 1) {\n                const fromx = Math.round(width * points[index - 1].x)\n                const fromy = Math.round(height * points[index - 1].y)\n\n                const tox = Math.round(width * point.x)\n                const toy = Math.round(height * point.y)\n                canvasArrowForTrack(ctx, fromx, fromy, tox, toy, maxLineWidth)\n            }\n        })\n        ctx.stroke()\n    })\n    return canvas\n}\n\nexport function drawTrack({ path, tracks, canvas }) {\n    return getImageInfo(path).then((img) => {\n        const { width, height } = img\n\n        const trackCanvas = getTrackCanvas({ width, height, tracks })\n\n        const layers = [img, trackCanvas]\n\n        drawImageScaled({ img, layers, canvas })\n        return { img }\n    })\n}\n"]}